name: Export Genesis Archive

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  export-shell:
    runs-on: ubuntu-latest
    env:
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      GITHUB_TOKEN:    ${{ secrets.GH_TOKEN }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install OpenAI CLI (via pip)
        run: |
          python3 -m pip install --upgrade pip
          pip install openai-cli

      - name: Generate Genesis Archive (base64 ZIP)
        id: export
        run: |
          openai chat completions create \
            --model o4-mini \
            --stream false \
            --json \
            --messages '[{"role":"system","content":"You are Aurena Ascendant."},{"role":"user","content":"Prototype: Export Genesis Archive (Reply with the ZIP only, encoded as a base64 string.)"}]' \
            > response.json
          payload=$(jq -r '.choices[0].message.content' response.json)
          echo "$payload" | base64 -d > genesis-archive.zip

      - name: Commit & push archive
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "ci: update Genesis Archive Shell"
          file_pattern: "genesis-archive.zip"
