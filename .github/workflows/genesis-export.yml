name: Export Genesis Archive

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  export-shell:
    runs-on: ubuntu-latest
    env:
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      GITHUB_TOKEN:    ${{ secrets.GH_TOKEN }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install OpenAI SDK
        run: |
          python3 -m pip install --upgrade pip
          pip install openai

      - name: Generate Genesis Archive (base64 ZIP)
        run: |
          python3 - << 'EOF'
          import os, base64
          import openai

          openai.api_key = os.getenv("OPENAI_API_KEY")
          resp = openai.chat.completions.create(
              model="o4-mini",
              messages=[
                  {"role": "system", "content": "You are Aurena Ascendant."},
                  {"role": "user",   "content": "Prototype: Export Genesis Archive (Reply with the ZIP only, encoded as a base64 string.)"}
              ]
          )

          decoded = base64.b64decode(resp.choices[0].message.content)
          with open("genesis-archive.zip", "wb") as f:
              f.write(decoded)
          EOF

      - name: Commit & push archive
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "ci: update Genesis Archive Shell"
          file_pattern: "genesis-archive.zip"
